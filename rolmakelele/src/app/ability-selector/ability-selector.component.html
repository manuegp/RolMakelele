<mat-accordion>
  <mat-expansion-panel *ngFor="let ab of abilities" hideToggle>
    <mat-expansion-panel-header class="align-items-center gap-2">
      <img
        [src]="ab.img ? serverUrl + ab.img : 'https://placehold.co/40x40/png'"
        alt="icon"
        width="40"
        height="40"
      />
      <mat-panel-title class="flex-grow-1 text-nowrap">
        {{ ab.name }}
      </mat-panel-title>
      <mat-panel-description>
        <button
          class="btn btn-outline-primary btn-sm"
          (click)="toggleAbility(ab.id); $event.stopPropagation()"
        >
          {{ selectedIds.includes(ab.id) ? "Quitar" : "Añadir" }}
        </button>
      </mat-panel-description>
    </mat-expansion-panel-header>
    <p>
      {{ ab.description }}
      <small class="text-muted">({{ ab.category }})</small>
      <mat-chip
        *ngIf="ab.type"
        class="me-2 text-white"
        [style.backgroundColor]="types.getColor(ab.type)"
      >
        {{ ab.type }}
      </mat-chip>
      <mat-chip *ngIf="ab.unique" color="warn" class="me-2" title="Movimiento exclusivo">
        Único
      </mat-chip>
    </p>
    <ul>
      <li *ngFor="let effect of ab.effects">
        <span>{{ effect.type }} sobre {{ effect.target }}</span>
        <span *ngIf="effect.stat"> ({{ effect.stat }})</span>
        <span> : {{ effect.value }}</span>
        <span *ngIf="effect.duration"> ({{ effect.duration }} turnos)</span>
        <span *ngIf="effect.ignoreDefense">
          (ignora defensa {{ effect.ignoreDefense * 100 }}%)
        </span>
      </li>
    </ul>
    <div *ngIf="ab.extraEffects?.length">
      <strong>Efectos extra:</strong>
      <ul>
        <li *ngFor="let effect of ab.extraEffects">
          <span>{{ effect.type }} sobre {{ effect.target }}</span>
          <span *ngIf="effect.stat"> ({{ effect.stat }})</span>
          <span> : {{ effect.value }}</span>
          <span *ngIf="effect.duration"> ({{ effect.duration }} turnos)</span>
          <span *ngIf="effect.ignoreDefense">
            (ignora defensa {{ effect.ignoreDefense * 100 }}%)
          </span>
        </li>
      </ul>
    </div>
  </mat-expansion-panel>
</mat-accordion>
